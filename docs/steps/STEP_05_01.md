# Шаг 5.1 — Multi-site: Регионы, Города, Сайты, Контакты сайта

Реализован CRUD в админке (Vue) и API для мульти-сайта по docs/ADMIN_MODULES.md и docs/DB_SCHEMA.md.

---

## Что сделано

### Backend (Laravel)

- **Контроллеры** в `App\Http\Controllers\Api\Cms\`:
  - `RegionController` — index (поиск по name/country_code, пагинация), store, show, update, destroy. При удалении проверка: нет городов.
  - `CityController` — index (поиск, фильтр region_id), store/update с валидацией slug уникален в рамках region_id, regex `[a-z0-9\-]+`.
  - `SiteController` — index (поиск по domain), store/update с уникальным domain; при установке is_primary сбрасывается у остальных.
  - `SiteContactController` — index (фильтр site_id, поиск), store/update по полям DB_SCHEMA (site_id, phone, email, address_*, work_time, company_name, logo_media_id, price_display_from, legal_link).

- **Валидация** строго по DB_SCHEMA (типы, длины, unique, exists).

- **Маршруты** под `auth:sanctum`, префикс `api/v1/cms`:
  - `apiResource`: regions, cities, sites, site-contacts (параметр site_contact для route model binding).

### Frontend (Vue)

- **Страницы** в `resources/js/pages/admin/cms/`:
  - `Regions.vue` — таблица, поиск, пагинация, модальное создание/редактирование/удаление.
  - `Cities.vue` — то же + выбор региона, slug; загрузка списка регионов для формы.
  - `Sites.vue` — домен, город (select), is_primary; загрузка списка городов.
  - `SiteContacts.vue` — фильтр по сайту, поиск, форма со всеми полями контакта (без выбора медиа пока — логотип будет в модуле медиа).

- **Маршруты** в `resources/js/admin.js`: `admin.cms.regions`, `admin.cms.cities`, `admin.cms.sites`, `admin.cms.site-contacts`.

### Меню админки

- В `App\Services\AdminMenu` добавлены пункты: Регионы, Города, Сайты, Контакты сайта (роли admin, manager). Иконки: map, building, globe, phone.

### Тесты

- `tests/Feature/AdminApiTest.php`: проверка меню обновлена — в меню есть «Регионы» и «Медиа».
- `tests/Feature/CmsMultisiteApiTest.php`: требование авторизации для GET /cms/regions; index возвращает пагинированный список; store создаёт регион с name и country_code.

---

## Команды проверки

```bash
# Миграции (если ещё не выполнялись)
php artisan migrate

# Тесты
php artisan test tests/Feature/ModelsRelationsTest.php
php artisan test tests/Feature/AdminApiTest.php
php artisan test tests/Feature/CmsMultisiteApiTest.php

# Список маршрутов CMS
php artisan route:list --path=cms
```

Ручная проверка: авторизоваться в /admin, открыть разделы Регионы, Города, Сайты, Контакты сайта — список, создание, редактирование, удаление (с учётом ограничений FK).
